service: search-api-sls

provider:
  name: aws
  runtime: nodejs18.x
  stage: ${opt:stage, 'dev'}
  environment: ${file(serverless.env.yml):${self:provider.stage}}

functions:
  ingest:
    handler: src/handlers/ingestionHandler.index
    events:
      - httpApi:
          path: /create
          method: post
  getAllDocument:
    handler: src/handlers/getAllDocumentsHandler.index
    events:
      - httpApi:
          path: /documents
          method: get
  healthCheck:
    handler: src/handlers/healthCheck.index
    events:
      - httpApi:
          path: /
          method: get
  triggerLogstashTask:
    handler: src/handlers/triggerTask.handler
    timeout: 30
    environment:
      CLUSTER_NAME: logstash-cluster
      TASK_DEFINITION: logstash-task:3
    events:
      - http:
          path: /trigger-task
          method: post
          cors: true
  checkTaskStatus:
    handler: src/handlers/checkStatus.handler
    timeout: 30
    environment:
      CLUSTER_NAME: logstash-cluster
    events:
      - http:
          path: /check-status/{taskArn}
          method: get
          cors: true

plugins:
  - serverless-offline

service: search-api-sls

provider:
  name: aws
  runtime: nodejs18.x
  environment: ${file(serverless.env.yml):${self:custom.stage}}

  
custom:
  stage: ${opt:stage, 'dev'}
  customDomain:
    domainName: ${self:custom.domains.${self:custom.stage}}
    basePath: ''
    stage: ${self:custom.stage}
    createRoute53Record: true
    endpointType: 'regional'
    apiType: HTTP
    securityPolicy: tls_1_2
  domains:
    dev: search-staging.devicebits.com
    prod: search.devicebits.com

functions:
  ingest:
    handler: src/handlers/ingestionHandler.index
    events:
      - httpApi:
          path: /create
          method: post
  getAllDocument:
    handler: src/handlers/getAllDocumentsHandler.index
    timeout: 300
    events:
      - httpApi:
          path: /documents
          method: get
  healthCheck:
    handler: src/handlers/healthCheck.index
    events:
      - httpApi:
          path: /
          method: get
  osSearchHandler:
    handler: src/handlers/osSearchHandler.index
    timeout: 300
    events:
      - httpApi:
          path: /osearch
          method: get

plugins:
  - serverless-offline
  - serverless-domain-manager
